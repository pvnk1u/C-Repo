# 函数

函数是C程序的构建块。每个函数本质上是一个自带声明和语句的小程序。可以利用函数把程序划分为小块，这样便于人们理解和修改程序。由于不必重复编写要多次使用的代码，函数可以使编程不那么单调乏味。此外，函数可以复用：一个函数最初可能是某个程序的一部分，但可以将其用于其他程序中。



到目前为止，我们的程序都只是由一个main函数构成的。本章将学习如何编写除main函数以外的其他函数，并更加深入地了解main函数本身。



## 函数的定义和调用

在介绍定义函数的规则之前，先来看3个简单的定义函数的程序。



### 计算平均值

假设我们经常需要计算两个double类型数值的平均值。C语言库没有“求平均值”的函数，但是可以自己定义一个。下面就是这个函数的形式：

```c
double average(double a,double b){
	return (a+b)/2;
}
```

在函数开始处放置的单词double表示average函数的返回类型，也就是每次调用该函数时返回数据的类型。标识符a和标识符b（即函数的形式参数）表示在调用average函数时需要提供的两个数。每一个形式参数都必须有类型（正像每个变量有类型一样），这里选择了double作为a和b的类型。函数的形式参数本质上是变量，其初始值在调用函数的时候才提供。



每个函数都有一个用花括号括起来的执行部分，称为函数体。average函数的函数体由一条return语句构成。执行这条语句将会使函数“返回”到调用它的地方，表达式（a+b）/2的值将作为函数的返回值。



为了调用函数，需要写出函数名及跟随其后的实际参数列表。例如，average(x,y)是对average函数的调用。实际参数用来给函数提供信息；在此例中，函数average需要知道是要求哪两个数的平均值。调用average(x,y)的效果就是把变量x和y的值复制给形式参数a和b，然后执行average函数的函数体。实际参数不一定要是变量，任何正确类型的表达式都可以，average(5.1,8.9)和average(x/2,y/3)都是合法的函数调用。



我们把average函数的调用放在需要使用其返回值的地方。例如，为了计算并显示出x和y的平均值，可以写成：

```c
printf("Average: %g\n",average(x,y));
```

这条语句产生如下效果：

1. 以变量x和y作为实际参数调用average函数。
2. 把x和y的值复制给a和b
3. average函数执行自己的return语句，返回a和b的平均值
4. printf函数显示出函数average的返回值（average函数的返回值成为了函数printf的一个实际参数）



注意，我们没有保存函数average的返回值。程序显示这个值后就把它丢弃了。如果需要在后面用到返回值，可以把这个返回值赋值给变量：

```c
avg = average(x,y);
```

这条语句调用了average函数，然后把它的返回值存储在变量avg中。



现在把average函数放在一个完整的程序中来使用。下面的程序读取了3个数并且计算它们的平均值，每次计算一对数的平均值：

```c
Enter three numbers: 3.5 9.6 10.2
Average of 3.5 and 9.6:6.55
Average of 9.6 and 10.2:9.9
Average of 3.5 and 10.2:6.85
```



完整程序如下：

```c
#include <stdio.h>

double average(double a,double b) {
    return (a+b) /2;
}

int main(void) {
    double x,y,z;

    printf("Enter three numbers: ");
    scanf("%lf%lf%lf",&x,&y,&z);
    printf("Average of %g and %g: %g\n",x,y,average(x,y));
    printf("Average of %g and %g: %g\n",y,z,average(y,z));
    printf("Average of %g and %g: %g\n",x,z,average(x,z));
    return 0;
}
```

这个程序表明只要需要可以频繁调用函数。



注意，这里把average函数的定义放在了main函数的前面。在后面将看到，把average函数的定义放在main函数的后面可能会有问题。



### 显示倒计数

不是每个函数都返回一个值。例如，进行输出操作的函数可能不需要返回任何值。为了指示出不带返回值的函数，需要指明这类函数的返回类型是void。（void是一种没有值的类型。）思考下面的函数，这个函数用来显示信息T minus n and counting，其中n的值在调用函数时提供：

```c
void print_count(int n)
{
	printf("T minus %d and counting\n",n);
}
```

函数printf_count有一个形式参数n，参数的类型为int。此函数没有任何返回值，所以用void指明它的返回值类型，并且略掉了return语句。既然print_count函数没有返回值，那么不能调用average函数的方法来调用它。print_count函数的调用必须自成一个语句：

```c
print_count(i);
```

下面这个程序在循环内调用了10次print_count函数：

```c
#include<stdio.h>

void print_count(int n) {
    printf("T minus %d and counting\n",n);
}

int main(void){
    int i;

    for (i = 10;i>0;--i) {
        print_count(i);
    }
    return 0;
}
```



### 显示双关语（改进版）

一些函数根本没有形式参数。思考下面这个print_pun函数，它在每次调用时显示一条双关语：

```c
void print_pun(void){
	printf("To C,or not to C: that is the question.\n");
}
```

在圆括号中的东西void表明print_pun函数没有实际参数（void占位符表示没有任何东西）。





遇到不带实际参数的函数时，只需要写出函数名并且在后面加上一对圆括号：

```c
print_pun();
```

即使没有实际参数也必须给出圆括号。



下面这个小程序测试了print_pun函数：

```c
#include<stdio.h>

void print_pun(void) {
    printf("To C,or not to C: that is the question.\n");
}

int main(void){
    print_pun();
    return 0;
}
```

### 函数定义

现在已经看过了一些例子，该来看看函数定义的一般格式了。

```
返回类型 函数名(形式参数){
	声明
	语句
}
```

函数的“返回类型”是函数返回值的类型。下列规则用来管理返回类型。

- 函数不能返回数组，但关于返回类型没有其他限制。
- 指定返回类型是void类型说明函数没有返回值。
- 如果省略返回类型，C89会假定函数返回值的类型是int类型，但在C99中这是不合法的。



函数名后边有一串形式参数列表。需要在每个形式参数的前面说明其类型，形式参数间用逗号进行分隔。如果函数没有形式参数，那么在圆括号内应该出现void。



函数体可以包含声明和语句。例如，average函数可以写成:

```c
double average(double a,double b){
	double sum;
	
	sum = a+b;
	return sum / 2;
}
```

函数体内声明的变量专属于此函数，其他函数不能对这些变量进行检查或修改。在C89中，变量声明必须出现在语句之前。在C99中，变量声明和语句可以混在一起，只要变量在第一次使用之前进行声明就行。



对于返回类型为void的函数（本书称为void函数），其函数体可以为空：

```c
void print_pun(void){
	
}
```

程序开发过程中留下空函数体是有意义的。由于没有时间完成函数，所以为它预留下空间，以后可以回来编写它的函数体。



### 函数调用

