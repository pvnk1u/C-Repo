# 指针和数组

上一章介绍了指针，并且说明了如何把指针用作函数的实际参数和函数的返回值。本章介绍指针的另一种应用。当指针指向数组元素时，C语言允许对指针进行算术运算（加法和减法），通过这种运算我们可以用指针代替数组下标对数组进行处理。



C语言中指针和数组的关系是非常紧密的。后面的章节将利用这种关系。理解指针和数组之间的关系对于熟练掌握C语言非常关键：它能使我们深入了解C语言的设计过程，并且能够帮助我们理解现有的程序。然而，需要知道的是，用指针处理数组的主要原因是效率，但是这里的效率提升已经不再像当初那么重要了，这主要归功于编译器的改进。



## 指针的算术运算

由11.5节（指针作为返回值）可知，指针可以指向数组元素。例如，假设已经声明a和p如下：

```c
int a[10],*p;
```

通过下列写法可以使p指向a[0]：

```c
p = &a[0];
```

现在可以通过p访问a[0]。例如，可以通过下列写法把值5存入a[0]中：

```c
*p = 5;
```



把指针p指向数组a的元素不是特别令人激动。但是，通过在p上执行指针算术运算（或者地址算术运算）可以访问数组a的其他所有元素。C语言支持3种（而且只有3种）格式的指针算术运算：

- 指针加上整数；
- 指针减去整数；
- 两个指针相减。



下面仔细研究一下每种运算。下面的所有例子都假设有如下声明：

```c
int a[10],*p,*q,i;
```



### 指针加上整数

指针p加上整数j产生指向特定元素的指针，这个特定元素是p原先指向的元素后的j个位置。更确切地说，如果p指向数组元素a[i]，那么p+j指向a[i+j]（当然，前提是a[i+j]必须存在）。



下面的示例说明指针的加法运算：

```c
p = &a[2];   // 指针p指向数组的第三个元素
q = p + 3;	// 指针q指向数组的第6个元素
p +=6;		// 指针p重新指向数组的第9个元素
```



### 指针减去整数

如果p指向数组元素a[i]，那么p-j指向a[i-j]。例如：

```c
p = &a[8];		// 指针p指向数组a的第9个元素
q = p -3;		// 指针q指向数组a的第6个元素
p -= 6;			// 指针p重新指向数组的第3个元素
```



### 两个指针相减

当两个指针相减时，结果为指针之间的距离（用数组元素的个数来度量）。因此，如果p指向a[i]且q指向a[j]，那么p-q就等于i-j。例如：

```c
p = &a[5];
q = &a[1];

i = p - q;		// i is 4
i = q - p;		// i is -4
```



在一个不指向任何数组元素的指针上执行算术运算会导致未定义的行为。此外，只有在两个指针指向同一个数组时，把它们相减才有意义。



