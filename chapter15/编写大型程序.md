# 编写大型程序

虽然某些C程序小得足够放入一个单独的文件中，但大多数程序都不是这样的。程序由多个文件构成的原则更容易让人接受。本章将会看到，常见的程序由多个源文件组成，通常还有一些头文件（header file）。**源文件包含函数的定义和外部变量，而头文件包含可以在源文件之间共享的信息。**



## 源文件

到现在为止一直假设C程序是由单独一个文件组成的。事实上，可以把程序分割成任意数量的源文件。根据惯例，源文件的扩展名为`.c`。每个源文件包含程序的部分内容，主要是函数和变量的定义。其中一个源文件必须包含一个名为`main`的函数，此函数作为程序的起始点。



把程序分割成多个源文件有许多显著的优点。

- 把相关的函数和变量分组放在同一个文件中可以使程序的结构清晰。
- 可以分别对每一个源文件进行编译。如果程序规模很大而且需要频繁改变（这一点在程序开发过程中是很普遍的）的话，这种方法可以极大地节约时间。
- 把函数分组放在不同的源文件中更易于复用。



## 头文件

当把程序分割为几个源文件时，问题也随之产生了：某文件中的函数如果调用定义在其他文件中的函数呢？函数如何访问其他文件中的外部变量呢？两个文件如何共享同一个宏定义或类型定义呢？答案是`#include`指令，此指令使得在任意数量的源文件中共享信息成为可能，这些信息可以是函数原型、宏定义、类型定义等。



`#include`指令告诉预处理器打开指定的文件，并且把此文件中的内容插入到当前文件中。因此，如果想让几个源文件可以访问相同的信息，可以把此信息放入一个文件中，然后利用`#include`指令把该文件的内容带进每个源文件中。把按照此种方式包含的文件称为头文件（有时称为包含文件）。根据惯例，头文件的扩展名为`.h`。



### #include指令

`#include`指令主要有两种书写格式。第一种格式用于属于C语言自身库的头文件：

```c
[#include指令 (格式1)]  #include<文件名>
```

第二种格式用于所有其他头文件，也包含任何自己编写的文件：

```c
[#include指令 (格式2)] #include "文件名"
```

这两种格式间的细微差异在于编译器定位头文件的方式。下面是大多数编译器遵循的规则。

- #include <文件名>

  搜寻系统头文件所在的目录（或多个目录）。（例如，在UNIX系统中，通常把系统头文件保存在目录/usr/include中。）

- #include "文件名"

  先搜寻当前目录，然后搜寻系统头文件所在的目录（或多个目录）。



### 共享宏定义和类型定义

大多数大型程序包含需要由几个源文件（或者，最极端的情况是用于全部源文件）共享的宏定义和类型定义。这些定义应该放在头文件中。



例如，假设正在编写的程序使用名为`BOOL`、`TRUE`和`FALSE`的宏。（C99中不需要这么做，因为<stdbool.h>头中定义了类似的宏。）我们把这些定义放在一个名为`boolean.h`的头文件中，这样做比在每个需要的源文件中重复定义这些宏更有意义：

```c
#define BOOL int
#define TRUE 1
#define FALSE 0
```

