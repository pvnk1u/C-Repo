# printf函数

printf函数被设计用来显示格式串的内容，并且在该串中的指定位置插入可能的值。调用printf函数时必须提供格式串，格式串后面的参数是需要在显示时插入到该串中的值：

```c
printf(格式串,表达式1,表达式2,...);
```

显示的值可以是常量、变量或者更加复杂的表达式。调用printf函数一次可以打印的值的个数没有限制。



格式串包含普通字符和转换说明，其中转换说明以字符%开头。转换说明是用来表示打印过程中待填充的值的占位符。跟随在字符%后面的信息指定了把数值从内部形式（二进制）转换成打印形式（字符）的方法，这也就是“转换说明”这一术语的由来。例如，转换说明%d指定printf函数把int型值从二进制形式转换成十进制数字组成的字符串，转换说明%f对float型值也进行类似的转换。



## 转换说明

转换说明给程序员提供了大量对输出格式的控制方法。另一方面，转换说明很可能很复杂且难以阅读。这里只介绍较为重要的性能。



在前面已经看到，转换说明可以包含格式化信息。具体来说，可以用`%.1f`来显示小数点后带一位数字的float型值。更一般地，转换说明可以用`%m.pX`格式或`%-m.pX`格式，这里的m和p都是整数常量，而X是字母，m和p都是可选的。如果省略p，m和p之间的小数点也要去掉。在转换说明`%10.2f`中，m是10，p是2，而X是f。在转换说明`%10f`中，m是10，p（连同小数点一起）省去了；而在转换说明`%.2f`中，p是2，m省去了。



最小字段宽度m指定了要显示的最少字符数量。如果要显示的数值所需的字符数少于m，那么值在字段内是右对齐的。（换句话说，在值前面放置额外的空格。）例如，转换说明`%4d`将以`·123`的形式显示数123（用`·`表示空格字符）。如果要显示的值所需字符数多于m，那么字段宽度会自动扩展为所需的尺寸。因此，转换说明`%4d`将以12345的形式显示数12345，而不会丢失数字。在m前放上一个负号会导致左对齐；转换说明`%-4d`将以`123·`的形式显示123。



精度p的含义很难描述，因为它依赖于转换说明符X的选择。X表明在显示数值前需要对其进行哪种转换。对数值来说最常用的转换说明符有以下几个：

- d

  表示十进制（基数为10）形式的整数。p指明了待显示的数字的最少个数（必要时在数前加上额外的0）；如果省略p，则默认它的值为1。

- e

  表示指数（科学记数法）形式的浮点数。p指明了小数点后应该出现的数字的个数（默认值为6）。如果p为0，则不显示小数点。

- f

  表示“定点十进制”形式的浮点数，没有指数。p的含义与在说明符e中的一样。

- g

  表示指数形式或者定点十进制形式的浮点数，形式的选择根据数的大小决定。p说明可以显示的有效数字（没有小数点后的数字）的最大数量。与转换说明符f不同，g的转换将不显示尾随的0。此外，如果要显示的数值没有小数点后的数字，g就不会显示小数点。



编写程序时无法预知数的大小或者数值变化范围很大的情况下，说明符g对于数的显示是特别有用的。在用于显示大小适中的数时，说明符g采用定点十进制形式。但是，在显示非常大或非常小的数时，说明符g会转换成指数形式以便减少所需的字符数。



下面的程序举例说明了用printf函数以各种格式显示整数和浮点数的方法。

```c
#include <stdio.h>

int main(void) {
    int i;
    float x;

    i = 40;
    x = 839.21f;

    printf("|%d|%5d|%-5d|%5.3d|\n",i,i,i,i);
    printf("|%10.3f|%10.3e|%-10g|\n",x,x,x);
    return 0;
}
```

在显示时，printf函数格式串中的字符`|`只是用来帮助显示每个数所占用的空格数量；不同于`%`或`\`，字符`|`对printf函数而言没有任何特殊意义。此程序的输出结果如下：

```shell
|40|   40|40   |  040|
|   839.210| 8.392e+02|839.21    |
```

下面仔细看一下上述程序中使用的转换说明：

- %d

  以十进制形式显示变量i，且占用最少的空间

- %5d

  以十进制形式显示变量i，且至少占用5个字符的空间。因为变量i只占两个字符，所以添加了三个空格。

- %-5d

  以十进制形式显示变量i，且至少占用5个字符的空间。因为表示变量i的值不需要用满5个字符，所以在后续位置上添加空格（更确切地说，变量i在长度为5的字段内是左对齐的）。

- %5.3d

  以十进制形式显示变量i，且至少占用5个字符的空间并至少有3位数字。因为变量i只有2个字符长度，所以要添加一个额外的0来保证有3位数字。现在只有3个字符长度，为了保证占用5个字符，还要添加2个空格（变量i是右对齐的）。

- %10.3f

  以定点十进制形式显示变量x，且总共用10个字符，其中小数点后保留3位数字。因为变量x只需要7个字符（即小数点前3位，小数点后3位，再加上小数点本身1位），所以在变量x前面有三个空格。

- %10.3e

  以指数形式显示变量x，且总共用10个字符，其中小数点后保留3位数字。因为变量x总共需要9个字符（包括指数），所以在变量x前面有一个空格。

- %-10g

  既可以以定点十进制形式显示变量x，也可以以指数形式显示变量x，且总共用10个字符。在这种情况下，printf函数选择用定点十进制形式显示变量x。负号的出现强制进行左对齐，所以有4个空格跟在变量x后面





## 转义序列

格式串中常用的代码`\n`被称为转义序列。转义序列使字符串包含一些特殊字符而不会使编译器引发问题，这些字符包括非打印的（控制）字符和对编译器有特殊含义的字符（如"）。先看一组示例：

- 警报（响铃）符：\a
- 回退符：\b
- 换行符：\n
- 水平制表符：\t



当这些转义序列出现在printf函数的格式串中时，它们表示在显示中执行的操作。在大多数机器上，输出`\a`会产生一声鸣响，输出`\b`会使光标从当前位置回退一个位置，输出`\n`会使光标跳到下一行的起始位置，输出`\t`会把光标移动到下一个制表符的位置。



字符串可以包含任意数量的转义序列。下面的printf函数示例中的格式串包含了6个转义序列：

```c
printf("Item\tUnit\tPurchase\n\tPrice\tDate\n");
```

执行上述语句显示出一条两行的标题：

```
Item    Unit    Purchase
        Price   Date
```



另一个常用的转义序列是`\"`，它表示字符`"`。因为字符`"`标记字符串的开始和结束，所以它不能出现在没有使用上述转义序列的字符串内。下面是一个示例：

```c
printf("\"Hello!\"");
```

这条语句产生如下输出：

```
"Hello!"
```

同理，为了显示单独一个`\` ，需要在字符串内放置两个`\`字符：

```c
printf("\\");
```



# scanf函数

如同printf函数用特定的格式显示输出一样，scanf函数也根据特定的格式读取输入。像printf函数的格式串一样，scanf函数的格式串也可以包含普通字符和转换说明两部分。scanf函数转换说明的用法和printf函数转换说明的用法本质上是一样的。



在许多情况下，scanf函数的格式串只包含转换说明，如下所示：

```c
int i,j;
float x,y;

scanf("%d%d%f%f",&i,&j,&x,&y);
```

假设用户录入了下列输入行：

```c
1 -20 .3 -4.0e3
```

scanf函数将读入上述行的信息，并且把这些符号转换成它们表示的数，然后分别把1、-20、0.3和-4000.0赋值给变量i、j、x和y。scanf函数调用中像`%d%d%f%f`这样紧密压缩的格式串是很普遍的，而printf函数的字符串很少有这样紧挨着的转换说明。



## 格式串中的普通字符

通过编写含有普通字符和转换说明的格式串能更进一步地理解模式匹配的概念。处理格式串中的普通字符时，scanf函数采取的动作依赖于这个字符是否为空白字符。



- 空白字符

  当在格式串中遇到一个或多个连续的空白字符时，scanf函数从输入中重复读取空白字符直到遇到一个非空白字符为止。

- 其他字符

  当在格式串中遇到非空白字符时，scanf函数将把它与下一个输入字符进行比较。如果两个字符相匹配，那么scanf函数会把不匹配的字符放回输入中，然后异常退出，而不进一步处理格式串或者从输入中读取字符。



例如，假设字符串是`%d/%d`，如果输入是：

```
·5/·96
```

在寻找整数时，scanf函数会跳过第一个空格，把%d与5相匹配，把/与/相匹配，在寻找下一个整数时跳过一个空格，并且把%d与96相匹配。另一方面，如果输入是：

```
·5·/·96
```

scanf函数会跳过一个空格，把%d与5相匹配，然后试图把格式串中的/与输入中的空格相匹配。但是二者不匹配，所以scanf函数把空格放回原处，把字符`·/·96`留给下一次scanf函数调用来读取。为了允许第一个数后边有空格，应使用格式串`%d /%d`。



为了显示scanf函数的模式匹配能力，考虑读入由用户键入的分数。分数通常的形式为分子/分母。scanf函数允许读入整个分数，而不用将分子和分母视为两个整数分别读入。下面的分数相加程序体现了这一方法。

```c
//
// Created by pvnk1u on 2024/6/26.
// 两个分数相加，体现scanf的模式匹配能力
//

#include <stdio.h>

int main(void) {
    int num1,denom1,num2,denom2,result_num,result_denom;

    printf("Enter first fraction: ");
    scanf("%d/%d",&num1,&denom1);

    printf("Enter second fraction: ");
    scanf("%d/%d",&num2,&denom2);

    result_num = num1 * denom2 + num2 *denom1;
    result_denom = denom1 * denom2;
    printf("The sum is %d/%d\n",result_num,result_denom);
    return 0;
}
```

运行这个程序，可能的显示如下：

```
Enter first fraction:5/6
Enter second fraction:3/4
The sum is 38/24
```

注意，结果并没有简化为最简分数。



