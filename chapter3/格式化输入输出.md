# printf函数

printf函数被设计用来显示格式串的内容，并且在该串中的指定位置插入可能的值。调用printf函数时必须提供格式串，格式串后面的参数是需要在显示时插入到该串中的值：

```c
printf(格式串,表达式1,表达式2,...);
```

显示的值可以是常量、变量或者更加复杂的表达式。调用printf函数一次可以打印的值的个数没有限制。



格式串包含普通字符和转换说明，其中转换说明以字符%开头。转换说明是用来表示打印过程中待填充的值的占位符。跟随在字符%后面的信息指定了把数值从内部形式（二进制）转换成打印形式（字符）的方法，这也就是“转换说明”这一术语的由来。例如，转换说明%d指定printf函数把int型值从二进制形式转换成十进制数字组成的字符串，转换说明%f对float型值也进行类似的转换。



## 转换说明

转换说明给程序员提供了大量对输出格式的控制方法。另一方面，转换说明很可能很复杂且难以阅读。这里只介绍较为重要的性能。



在前面已经看到，转换说明可以包含格式化信息。具体来说，可以用%.1来显示小数点后带一位数字的float型值。更一般地，转换说明可以用`%m.pX`格式或`%-m.pX`格式，这里的m和p都是整数常量，而X是字母，m和p都是可选的。如果省略p，m和p之间的小数点也要去掉。在转换说明`%10.2f`中，m是10，p是2，而X是f。在转换说明`%10f`中，m是10，p（连同小数点一起）省去了；而在转换说明`%.2f`中，p是2，m省去了。



最小字段宽度m指定了要显示的最少字符数量。如果要显示的数值所需的字符数少于m，那么值在字段内是右对齐的。（换句话说，在值前面放置额外的空格。）例如，转换说明`%4d`将以`·123`的形式显示数123（用`·`表示空格字符）。如果要显示的值所需字符数多于m，那么字段宽度会自动扩展为所需的尺寸。因此，转换说明`%4d`将以12345的形式显示数12345，而不会丢失数字。在m前放上一个负号会导致左对齐；转换说明`%-4d`将以`123·`的形式显示123。



精度p的含义很难描述，因为它依赖于转换说明符X的选择。X表明在显示数值前需要对其进行哪种转换。对数值来说最常用的转换说明符有以下几个：

- d

  表示十进制（基数为10）形式的整数。p指明了待显示的数字的最少个数（必要时在数前加上额外的0）；如果省略p，则默认它的值为1。

- e

  表示指数（科学记数法）形式的浮点数。p指明了小数点后应该出现的数字的个数（默认值为6）。如果p为0，则不显示小数点。

- f

  表示“定点十进制”形式的浮点数，没有指数。p的含义与在说明符e中的一样。

- g

  表示指数形式或者定点十进制形式的浮点数，形式的选择根据数的大小决定。p说明可以显示的有效数字（没有小数点后的数字）的最大数量。与转换说明符f不同，g的转换将不显示尾随的0。此外，如果要显示的数值没有小数点后的数字，g就不会显示小数点。



编写程序时无法预知数的大小或者数值变化范围很大的情况下，说明符g对于数的显示是特别有用的。在用于显示大小适中的数时，说明符g采用定点十进制形式。但是，在显示非常大或非常小的数时，说明符g会转换成指数形式以便减少所需的字符数。



下面的程序举例说明了用printf函数以各种格式显示整数和浮点数的方法。

```c
#include <stdio.h>

int main(void) {
    int i;
    float x;

    i = 40;
    x = 839.21f;

    printf("|%d|%5d|%-5d|%5.3d|\n",i,i,i,i);
    printf("|%10.3f|%10.3e|%-10g|\n",x,x,x);
    return 0;
}
```

在显示时，printf函数格式串中的字符`|`只是用来帮助显示每个数所占用的空格数量；不同于`%`或`\`，字符`|`对printf函数而言没有任何特殊意义。此程序的输出结果如下：

```shell
|40|   40|40   |  040|
|   839.210| 8.392e+02|839.21    |
```

下面仔细看一下上述程序中使用的转换说明：

- %d

  以十进制形式显示变量i，且占用最少的空间

- %5d

  以十进制形式显示变量i，且至少占用5个字符的空间。因为变量i只占两个字符，所以添加了三个空格。

- %-5d

  以十进制形式显示变量i，且至少占用5个字符的空间。因为表示变量i的值不需要用满5个字符，所以在后续位置上添加空格（更确切地说，变量i在长度为5的字段内是左对齐的）。

- %5.3d

  以十进制形式显示变量i，且至少占用5个字符的空间并至少有3位数字。因为变量i只有2个字符长度，所以要添加一个额外的0来保证有3位数字。现在只有3个字符长度，为了保证占用5个字符，还要添加2个空格（变量i是右对齐的）。

- %10.3f

  以定点十进制形式显示变量x，且总共用10个字符，其中小数点后保留3位数字。因为变量x只需要7个字符（即小数点前3位，小数点后3位，再加上小数点本身1位），所以在变量x前面有三个空格。

- %10.3e

  以指数形式显示变量x，且总共用10个字符，其中小数点后保留3位数字。因为变量x总共需要9个字符（包括指数），所以在变量x前面有一个空格。

- %-10g

  既可以以定点十进制形式显示变量x，也可以以指数形式显示变量x，且总共用10个字符。在这种情况下，printf函数选择用定点十进制形式显示变量x。负号的出现强制进行左对齐，所以有4个空格跟在变量x后面





