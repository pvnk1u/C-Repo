# 指针的高级应用

前面几章描述了指针的两种重要应用。第11章说明了如何利用指向变量的指针作为函数的参数从而允许函数修改该变量。第12章说明了如何对指向数组元素的指针进行算术运算来处理数组。本章则通过观察另外两种应用来完善指针的内容：动态存储分配和指向函数的指针。



**通过使用动态存储分配，程序可以在执行期间获得需要的内存块。**第一节将解释动态存储分配的基本概念。第二节则讨论动态分配字符串，这比通常的字符数组更加灵活。第三节大概地介绍数组的动态存储分配。第四节处理存储分配的问题，即不再需要内存单元时，动态地释放已分配的内存块。



因为动态分配的结构可以链接在一起形成表、树和其他高度灵活的数据结构，所以它们在C语言编程中扮演着重要的角色。第五节重点讲述链表，它是最基础的链式数据结构。这一节中引出的问题（“指向指针的指针”的概念）对引出第六节非常重要。



第七节介绍指向函数的指针，这是非常有用的内容。C语言中一些功能最强大的库函数都期望把指向函数的指针作为参数。这里将考察其中一个函数qsort，它可以对任意数组成员进行排序。



最后两节讨论C99中新出现的与指针相关的特性：受限指针和灵活数组成员。



## 动态存储分配

C语言中的数据结构通常是固定大小的。例如，一旦程序完成编译，数组元素的数量就固定了。（**在C99中，变长数组（8.3节）的长度在运行时确定，但在数组的生命周期内仍然是固定长度的。**）因为在编写程序时强制选择了大小，所以固定大小的数据结构可能会有问题。也就是说，在不修改程序并且再次编译程序的情况下无法改变数据结构的大小。



请思考16.3节中允许用户向数据库中添加零件的inventory程序。数据库存储在长度为100的数组中。为了扩大数据库的容量，可以增加数组的大小并且重新编译程序。但是，无论如何增大数组，始终有可能填满数组。幸运的是，还有别的办法。**C语言支持动态存储分配，即在程序执行期间分配内存单元的能力。利用动态存储分配，可以设计出能根据需要扩大（和缩小）的数据结构。**



**虽然动态存储分配适用于所有类型的数据，但主要用于字符串、数组和结构。动态分配的结构是特别有趣的，因为可以把它们链接形成表、树或其他数据结构。**



### 内存分配函数

为了动态地分配存储空间，需要调用三种内存分配函数的一种，这些函数都是声明在`<stdlib.h>`头中的。

- **malloc函数**

  **分配内存块，但是不对内存块进行初始化**

- **calloc函数**

  **分配内存块，并且对内存块进行清零**

- **reallloc**

  **调整先前分配的内存块大小**



在这三种函数中，malloc函数是最常用的一种。因为malloc函数不需要对分配的内存块进行清零，所以它比calloc更高效。



**当为申请内存块而调用内存分配函数时，由于函数无法知道计划存储在内存块中的数据是什么类型的，所以它不能返回int类型、char类型等普通类型的指针。取而代之的，函数会返回`void *`类型的值。`void *`类型的值是“通用”指针，本质上它只是内存地址。**



